<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Piers-Harris 2 – Test</title>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #f2f6fc;
        margin: 0;
        padding: 0;
    }

    .container {
        max-width: 900px;
        margin: 40px auto;
        background: white;
        padding: 35px;
        border-radius: 14px;
        box-shadow: 0 6px 24px rgba(0,0,0,0.10);
        border: 1px solid #dbe7ff;
    }

    h1 {
        font-size: 32px;
        margin-bottom: 15px;
        color: #0a3d62;
        text-align: center;
        font-weight: 900;
    }

    .instructions {
        text-align: center;
        margin-bottom: 25px;
        font-size: 18px;
        color: #1b4f72;
    }

    .question {
        padding: 14px;
        border-bottom: 1px solid #eee;
        border-radius: 8px;
        transition: 0.25s;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .question.active {
        background: #e9f3ff;
        border: 1px solid #4da3ff;
        box-shadow: 0 0 8px rgba(0,123,255,0.35);
    }

    .answer-label {
        font-weight: bold;
        margin-left: 10px;
        font-size: 18px;
    }

    .explain-label {
        font-size: 14px;
        color: #1b4f72;
        opacity: 0.7;
    }

    button {
        margin-top: 25px;
        padding: 16px 26px;
        font-size: 20px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        width: 100%;
        box-shadow: 0 3px 10px rgba(0,0,0,0.15);
        font-weight: bold;
    }

    button:hover {
        background: #0d86ff;
    }

    /* ---- RESULTS STYLING ---- */
    #results {
        margin-top: 35px;
    }

    .result-card {
        background: #f7faff;
        border: 1px solid #d4e5ff;
        padding: 18px 22px;
        border-radius: 10px;
        margin-bottom: 18px;
    }

    .result-title {
        font-weight: bold;
        font-size: 20px;
        color: #0a3d62;
        margin-bottom: 8px;
    }

    .result-text {
        font-size: 17px;
        color: #123;
        margin: 4px 0;
    }

    .subscale-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 12px;
    }

    .subscale-table th, .subscale-table td {
        padding: 10px;
        border-bottom: 1px solid #e4ecf7;
        text-align: left;
    }

    .subscale-table th {
        background: #eef5ff;
        font-weight: bold;
        color: #0a3d62;
    }

</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>

<body>
<div class="container">
    <h1>Piers-Harris 2 – Sebahodnotiaci dotazník</h1>

    <div class="instructions">
        Stláčaj <strong>1 (ÁNO)</strong> alebo <strong>0 (NIE)</strong>.<br>
        Aktuálna otázka je zvýraznená modrou.
    </div>

    <form id="testForm"></form>

    <button id="btnEvaluate">Vyhodnotiť výsledky</button>

    <div id="results"></div>
</div>

<script>
/* ------------- SCALE NAMES ------------- */
const SCALE_NAMES = {
    BEH: "Chování a sebekontrola",
    INT: "Intelekt a školní status",
    PHY: "Fyzický vzhled a atributy",
    FRE: "Absence úzkosti",
    POP: "Popularita",
    HAP: "Štěstí a spokojenost"
};


function incToT(inc) {
    if (inc === 0) return 37;
    if (inc === 1) return 47;
    if (inc === 2) return 57;
    if (inc === 3) return 67;
    if (inc === 4) return 73;
    if (inc === 5) return 78;
    if (inc === 6) return 79;
    return 80; 
}


/* ------------- KEYING ------------- */
const keyedYes = [
    2,5,9,12,15,16,18,22,24,26,28,
    31,33,34,39,41,42,44,46,49,50,
    53,54,55,60
];

const keyedNo = [
    1,3,4,6,7,8,10,11,13,14,17,19,20,21,
    23,25,27,29,30,32,35,36,37,38,40,43,
    45,47,48,51,52,56,57,58,59
];

/* ------------- SUBSCALES ------------- */
const scales = {
    BEH: [12,13,14,18,19,20,27,30,36,38,45,48,58,60],
    INT: [5,7,12,16,18,21,22,24,25,26,34,39,43,50,52,55],
    PHY: [5,8,9,15,26,33,39,44,46,49,54],
    FRE: [4,6,7,8,10,17,23,29,31,32,35,40,56,59],
    POP: [1,3,6,11,32,37,39,41,47,51,54,57],
    HAP: [2,8,28,31,35,40,42,49,53,60]
};

/* ------------- VALIDITA – INKONZISTENCIE ------------- */
const INC_PAIRS = [
    { a: 1,  b: 47, badA: 0, badB: 1 },
    { a: 2,  b: 42, badA: 0, badB: 1 },
    { a: 3,  b: 41, badA: 1, badB: 0 },
    { a: 4,  b: 40, badA: 1, badB: 0 },
    { a: 5,  b: 43, badA: 0, badB: 1 },
    { a: 7,  b: 10, badA: 0, badB: 1 },
    { a: 9,  b: 51, badA: 1, badB: 0 },
    { a: 14, b: 20, badA: 1, badB: 0 },
    { a: 18, b: 21, badA: 0, badB: 1 },
    { a: 19, b: 27, badA: 0, badB: 1 },
    { a: 26, b: 39, badA: 0, badB: 1 },
    { a: 29, b: 56, badA: 1, badB: 0 },
    { a: 31, b: 35, badA: 0, badB: 1 },
    { a: 44, b: 49, badA: 1, badB: 0 },
    { a: 53, b: 60, badA: 1, badB: 0 }
];

/* ------------- T-TABLES ------------- */
const T_TABLE = {
    TOT: {
        0:20,1:20,2:20,3:20,4:20,5:20,6:20,7:20,8:20,9:20,
        10:21,11:22,12:23,13:24,14:25,15:26,16:27,17:28,
        18:29,19:30,20:31,21:32,22:33,23:34,24:35,25:35,
        26:36,27:37,28:38,29:39,30:40,31:41,32:42,33:43,
        34:44,35:45,36:46,37:47,38:48,39:49,40:50,41:51,
        42:52,43:53,44:54,45:55,46:56,47:57,48:57,49:58,
        50:59,51:60,52:61,53:62,54:63,55:64,56:65,57:66,
        58:67,59:68
    },

    BEH: {0:20,1:21,2:22,3:26,4:29,5:32,6:36,7:39,8:42,9:46,10:49,11:52,12:56,13:59,14:62},
    INT: {0:21,1:24,2:27,3:30,4:34,5:36,6:39,7:42,8:45,9:48,10:51,11:54,12:57,13:60,14:63,15:66,16:68},
    PHY: {0:27,1:30,2:34,3:37,4:40,5:44,6:47,7:51,8:54,9:57,10:61,11:64},
    FRE: {0:25,1:28,2:31,3:33,4:36,5:39,6:42,7:45,8:48,9:51,10:53,11:56,12:59,13:62,14:65},
    POP: {0:20,1:24,2:28,3:31,4:35,5:38,6:42,7:45,8:49,9:52,10:56,11:60,12:63},
    HAP: {0:20,1:22,2:26,3:30,4:34,5:38,6:43,7:47,8:51,9:55,10:59}
};

/* ------------- INTERPRETÁCIA ------------- */
function interpretTOT(T) {
    if (T >= 70) return "Výrazný nadpriemer";
    if (T >= 60) return "Nadpriemer";
    if (T >= 56) return "Vyšší priemer";
    if (T >= 45) return "Priemer";
    if (T >= 40) return "Nižší priemer";
    if (T >= 30) return "Podpriemer";
    return "Výrazný podpriemer";
}

function interpretSubscale(T) {
    if (T >= 56) return "Nadpriemer";
    if (T >= 45) return "Priemer";
    if (T >= 40) return "Nižší priemer";
    if (T >= 30) return "Podpriemer";
    return "Výrazný podpriemer";
}

/* ------------- GENERATE QUESTIONS ------------- */
let answers = {};
let activeQuestion = 1;

const form = document.getElementById("testForm");

for (let i = 1; i <= 60; i++) {
    const div = document.createElement("div");
    div.classList.add("question");
    div.id = `q-${i}`;
    div.innerHTML = `
        <div>
            <strong>${i}.</strong>
            <span class="answer-label" id="ans-${i}"></span>
        </div>
        <div class="explain-label">1 = Áno, 0 = Nie</div>
    `;
    form.appendChild(div);
}

for (let i = 1; i <= 60; i++) {
    document.getElementById(`q-${i}`).addEventListener("click", () => {
        activeQuestion = i;
        highlightActive();
    });
}

function highlightActive() {
    for (let i = 1; i <= 60; i++) {
        document.getElementById(`q-${i}`).classList.remove("active");
    }
    const q = document.getElementById(`q-${activeQuestion}`);
    q.classList.add("active");
    q.scrollIntoView({ behavior: "smooth", block: "center" });
}

highlightActive();

/* ------------- ANSWERS VIA KEYBOARD ------------- */
document.addEventListener("keydown", function(e) {
    if (e.key === "1" || e.key === "0") {
        const value = Number(e.key);
        answers[activeQuestion] = value;

        const ansLabel = document.getElementById(`ans-${activeQuestion}`);
        ansLabel.textContent = value === 1 ? "ÁNO" : "NIE";
        ansLabel.style.color = value === 1 ? "#007bff" : "#ff4d4d";

        if (activeQuestion < 60) activeQuestion++;
        highlightActive();
    }
});

/* ------------- EVALUATE ------------- */
document.getElementById("btnEvaluate").addEventListener("click", () => {

    if (Object.keys(answers).length < 60) {
        alert("Vyplň všetky otázky.");
        return;
    }

    /* ---------- VALIDITA ---------- */
    let incErrors = 0;
    let ignoredItems = new Set();

    INC_PAIRS.forEach(p => {
        if (answers[p.a] === p.badA && answers[p.b] === p.badB) {
            incErrors++;
            ignoredItems.add(p.a);
        }
    });

    /* ---------- SCORE FUNCTION ---------- */
    function scoreItem(num) {
        if (ignoredItems.has(num)) return 0;

        if (keyedYes.includes(num)) return answers[num] === 1 ? 1 : 0;
        if (keyedNo.includes(num))  return answers[num] === 0 ? 1 : 0;

        return 0;
    }

    /* ---------- TOT ---------- */
    let totRaw = 0;
    for (let i = 1; i <= 60; i++) totRaw += scoreItem(i);
    let totT = T_TABLE.TOT[totRaw];

    /* ---------- RES ---------- */
    let yesCount = Object.values(answers).filter(v => v === 1).length;
    let noCount = 60 - yesCount;

    /* ---------- BUILD RESULTS ---------- */
    let out = `
<div class="result-card">

    <div class="result-title">Výsledky</div>

    <table class="subscale-table" style="margin-bottom:18px;">
        <tr><th style="width:220px;">Parameter</th><th>Hodnota</th></tr>

        <tr>
            <td><strong>Validita</strong></td>
            <td>${incErrors === 0 ? "Test je platný" : "NEPLATNÝ – inkonzistencií: " + incErrors}</td>
        </tr>

        <tr>
            <td><strong>INC – T skóre</strong></td>
            <td>${incToT(incErrors)}</td>
        </tr>


        <tr>
            <td><strong>TOT – Celkové RAW</strong></td>
            <td>${totRaw}</td>
        </tr>

        <tr>
            <td><strong>TOT – T skóre</strong></td>
            <td>${totT} (${interpretTOT(totT)})</td>
        </tr>

        <tr>
            <td><strong>RES – počet ÁNO</strong></td>
            <td>${yesCount}</td>
        </tr>

        <tr>
            <td><strong>RES – počet NIE</strong></td>
            <td>${noCount}</td>
        </tr>
    </table>

    <div class="result-title" style="margin-top:25px;">Subškály</div>

    <table class="subscale-table">
        <tr>
            <th>Skratka</th>
            <th>Názov škály</th>
            <th>RAW</th>
            <th>T</th>
            <th>Interpretácia</th>
        </tr>
`;

    let tScores = [];

    for (let scale in scales) {
        let raw = 0;
        scales[scale].forEach(q => raw += scoreItem(q));

        let T = T_TABLE[scale][raw] ?? null;
        tScores.push(T ?? 0);

        out += `
            <tr>
                <td><strong>${scale}</strong></td>
                <td>${SCALE_NAMES[scale]}</td>
                <td>${raw}</td>
                <td>${T}</td>
                <td>${interpretSubscale(T)}</td>
            </tr>
        `;
    }

    out += `
        </table>
</div>
`;

    document.getElementById("results").innerHTML = out;

});
</script>

</body>
</html>
