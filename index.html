<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Piers-Harris 2 – Test</title>

<style>
    body {
        font-family: Arial, sans-serif;
        background: linear-gradient(to bottom right, #e7f3ff, #cfe6ff);
        margin: 0;
        padding: 0;
    }

    .container {
        max-width: 850px;
        margin: 40px auto;
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 6px 20px rgba(0,0,0,0.12);
        border: 1px solid #d0e4ff;
    }

    h1 {
        font-size: 32px;
        margin-bottom: 15px;
        color: #0a3d62;
        text-align: center;
        font-weight: 900;
        letter-spacing: 0.5px;
    }

    .instructions {
        text-align: center;
        margin-bottom: 25px;
        font-size: 18px;
        color: #1b4f72;
    }

    .question {
        padding: 14px;
        border-bottom: 1px solid #eee;
        border-radius: 8px;
        transition: 0.25s;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .question.active {
        background: #e0f0ff;
        border: 1px solid #4da3ff;
        box-shadow: 0 0 6px rgba(0,123,255,0.4);
    }

    .answer-label {
        font-weight: bold;
        margin-left: 10px;
        font-size: 18px;
    }

    .explain-label {
        font-size: 14px;
        color: #1b4f72;
        opacity: 0.7;
    }

    button {
        margin-top: 25px;
        padding: 16px 26px;
        font-size: 20px;
        background: linear-gradient(to right, #4da3ff, #007bff);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        width: 100%;
        box-shadow: 0 3px 8px rgba(0,0,0,0.2);
        font-weight: bold;
        letter-spacing: 0.5px;
    }

    button:hover {
        background: linear-gradient(to right, #6bb7ff, #3395ff);
    }

    .results {
        margin-top: 30px;
        padding-top: 15px;
        border-top: 2px solid #d6eaff;
    }

    .scale-result {
        font-size: 19px;
        padding: 6px 0;
    }

    #radarContainer {
        margin-top: 40px;
        padding: 20px 0;
    }

    canvas {
        max-width: 100%;
        max-height: 450px;
    }
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>

<body>
<div class="container">
    <h1>Piers-Harris 2 – Sebahodnotiaci dotazník</h1>

    <div class="instructions">
        Stláčaj <strong>1 (ÁNO)</strong> alebo <strong>0 (NIE)</strong>.<br>
        Aktuálna otázka je vždy zvýraznená modrou.
    </div>

    <form id="testForm"></form>

    <button id="btnEvaluate">Vyhodnotiť výsledky</button>

    <div id="results" class="results"></div>

    <div id="radarContainer">
        <canvas id="radarChart"></canvas>
    </div>
</div>

    <script>
// -----------------------------------------
// KEYING (scored YES / scored NO)
// -----------------------------------------

const keyedYes = [
    2,5,9,12,15,16,18,22,24,26,28,
    31,33,34,39,41,42,44,46,49,50,
    53,54,55,60
];

const keyedNo = [
    1,3,4,6,7,8,10,11,13,14,17,19,20,21,23,25,27,29,30,32,35,
    36,37,38,40,43,45,47,48,51,52,56,57,58,59
];

// -----------------------------------------
// SUBSCALE ITEMS
// -----------------------------------------

const scales = {
    BEH: [12,13,14,18,19,20,27,30,36,38,45,48,58,60],
    INT: [5,7,12,16,18,21,22,24,25,26,34,39,43,50,52,55],
    PHY: [5,8,9,15,26,33,39,44,46,49,54],
    FRE: [4,6,7,8,10,17,23,29,31,32,35,40,56,59],
    POP: [1,3,6,11,32,37,39,41,47,51,54,57],
    HAP: [2,8,28,31,35,40,42,49,53,60]
};


// -----------------------------------------
// VALIDITA – presné kombinácie inkonzistencie
// -----------------------------------------

const INC_PAIRS = [
    { a: 1,  b: 47, badA: 0, badB: 1 },
    { a: 2,  b: 42, badA: 0, badB: 1 },
    { a: 3,  b: 41, badA: 1, badB: 0 },
    { a: 4,  b: 40, badA: 1, badB: 0 },
    { a: 5,  b: 43, badA: 0, badB: 1 },
    { a: 7,  b: 10, badA: 0, badB: 1 },
    { a: 9,  b: 51, badA: 1, badB: 0 },
    { a: 14, b: 20, badA: 1, badB: 0 },
    { a: 18, b: 21, badA: 0, badB: 1 },
    { a: 19, b: 27, badA: 0, badB: 1 },
    { a: 26, b: 39, badA: 0, badB: 1 },
    { a: 29, b: 56, badA: 1, badB: 0 },
    { a: 31, b: 35, badA: 0, badB: 1 },
    { a: 44, b: 49, badA: 1, badB: 0 },
    { a: 53, b: 60, badA: 1, badB: 0 }
];



const T_TABLE = {

TOT: {
    0:20, 1:20, 2:20, 3:20, 4:20,
    5:20, 6:20, 7:20, 8:20, 9:20,
    10:21, 11:22, 12:23,
    13:24, 14:25, 15:26, 16:27, 17:28,
    18:29, 19:30, 20:31, 21:32, 22:33,
    23:34, 24:35, 25:35,
    26:36, 27:37, 28:38, 29:39, 30:40,
    31:41, 32:42, 33:43, 34:44, 35:45,
    36:46, 37:47, 38:48,
    39:49, 40:50, 41:51, 42:52, 43:53,
    44:54, 45:55, 46:56, 47:57, 48:57,
    49:58, 50:59,
    51:60, 52:61, 53:62, 54:63,
    55:64, 56:65, 57:66, 58:67, 59:68
},



    BEH: {
        0: 20,
        1: 21,
        2: 22,
        3: 26,
        4: 29,
        5: 32,
        6: 36,
        7: 39,
        8: 42,
        9: 46,
        10: 49,
        11: 52,
        12: 56,
        13: 59,
        14: 62
    },

    INT: {
        0:21, 1:24, 2:27, 3:30, 4:34,
        5:36, 6:39, 7:42, 8:45, 9:48,
        10:49, 11:52, 12:56, 13:59, 14:62
    },

    PHY: {
        0:27, 1:30, 2:34, 3:37, 4:40,
        5:44, 6:47, 7:51, 8:54, 9:57,
        10:61, 11:64
    },

    FRE: {
        0:25, 1:28, 2:31, 3:33, 4:36,
        5:39, 6:42, 7:45, 8:48, 9:51,
        10:53, 11:56, 12:59, 13:62, 14:65
    },

    POP: {
        0:20, 1:24, 2:28, 3:31, 4:35,
        5:38, 6:42, 7:45, 8:49, 9:52,
        10:56, 11:60, 12:63
    },

    HAP: {
        0:20, 1:22, 2:26, 3:30, 4:34,
        5:38, 6:43, 7:47, 8:51, 9:55, 10:59
    }
};

// -----------------------------------------
// INTERPRETÁCIA T-skóre
// -----------------------------------------

function interpret(T) {
    if (T >= 70) return "Výrazne nadpriemerné";
    if (T >= 60) return "Nadpriemer";
    if (T >= 45) return "Priemer";
    if (T >= 40) return "Nižší priemer";
    return "Podpriemer";
}

// -----------------------------------------
// GENERÁCIA OTÁZOK
// -----------------------------------------

let answers = {};
let activeQuestion = 1;

const form = document.getElementById("testForm");

// 1️⃣ najprv vygenerujeme otázky
for (let i = 1; i <= 60; i++) {
    const div = document.createElement("div");
    div.classList.add("question");
    div.id = `q-${i}`;
    div.innerHTML = `
        <div>
            <strong>${i}.</strong>
            <span class="answer-label" id="ans-${i}"></span>
        </div>
        <div class="explain-label">1 = Áno, 0 = Nie</div>
    `;
    form.appendChild(div);
}

// 2️⃣ až teraz môžeme pridať click-listenery
for (let i = 1; i <= 60; i++) {
    document.getElementById(`q-${i}`).addEventListener("click", () => {
        activeQuestion = i;
        highlightActive();
    });
}

// -----------------------------------------
// HIGHLIGHT ACTIVE
// -----------------------------------------

function highlightActive() {
    for (let i = 1; i <= 60; i++) {
        document.getElementById(`q-${i}`).classList.remove("active");
    }
    const q = document.getElementById(`q-${activeQuestion}`);
    q.classList.add("active");
    q.scrollIntoView({ behavior: "smooth", block: "center" });
}

// 3️⃣ označíme prvú otázku
highlightActive();


// -----------------------------------------
// KEYBOARD INPUT 1 / 0
// -----------------------------------------

document.addEventListener("keydown", function(e) {
    if (e.key === "1" || e.key === "0") {
        const value = Number(e.key);
        answers[activeQuestion] = value;

        const ansLabel = document.getElementById(`ans-${activeQuestion}`);
        ansLabel.textContent = value === 1 ? "ÁNO" : "NIE";
        ansLabel.style.color = value === 1 ? "#007bff" : "#ff4d4d";

        if (activeQuestion < 60) activeQuestion++;
        highlightActive();
    }
});

// -----------------------------------------
// EVALUATE
// -----------------------------------------

document.getElementById("btnEvaluate").addEventListener("click", () => {

    if (Object.keys(answers).length < 60) {
        alert("Vyplň všetky otázky.");
        return;
    }

    const resultsDiv = document.getElementById("results");
    let out = "<h2>Výsledky</h2>";

// presný výpočet inkonzistencie podľa manuálu
    let incErrors = 0;

    INC_PAIRS.forEach(p => {
        const A = answers[p.a];
        const B = answers[p.b];

        // inkonzistentné je IBA ak odpovede presne sedia na definovaný "zlý vzorec"
        if (A === p.badA && B === p.badB) {
            incErrors++;
        }
    });

    out += `<p><strong>Validita:</strong> ${
        incErrors === 0 ? "Test je platný" : "NEPLATNÝ – inkonzistencií: " + incErrors
    }</p>`;

    // SCORING FUNCTION
    function scoreItem(num) {
        if (keyedYes.includes(num)) return answers[num] === 1 ? 1 : 0;
        if (keyedNo.includes(num))  return answers[num] === 0 ? 1 : 0;
        return 0;
    }

    // TOT
    let totRaw = 0;
    for (let i = 1; i <= 60; i++) totRaw += scoreItem(i);

    const totT = T_TABLE.TOT[totRaw] ?? null;

    out += `<p><strong>TOT RAW:</strong> ${totRaw}, 
            <strong>TOT T:</strong> ${totT} 
            (${totT !== null ? interpret(totT) : "N/A"})</p>`;

    // RES – Response Style (počet ÁNO a NIE)
        let yesCount = Object.values(answers).filter(v => v === 1).length;
        let noCount = 60 - yesCount;

        out += `
            <h3>RES – Response Style</h3>
            <p><strong>Počet ÁNO:</strong> ${yesCount}</p>
            <p><strong>Počet NIE:</strong> ${noCount}</p>
        `;


    // SUBŠKÁLY
    out += "<h3>Subškály</h3>";

    let tScores = [];

    for (let scale in scales) {
        let raw = 0;
        scales[scale].forEach(q => raw += scoreItem(q));
        let T = T_TABLE[scale][raw] ?? null;

        out += `<p><strong>${scale}</strong>: RAW ${raw}, 
                T ${T} (${T !== null ? interpret(T) : "N/A"})</p>`;

        tScores.push(T ?? 0);
    }

    resultsDiv.innerHTML = out;

    // -----------------------------------
    // RADAR GRAF
    // -----------------------------------

    const ctx = document.getElementById("radarChart");

    new Chart(ctx, {
        type: 'radar',
        data: {
            labels: ['BEH','INT','PHY','FRE','POP','HAP'],
            datasets: [{
                label: 'T-skóre subškál',
                data: tScores,
                fill: true,
                backgroundColor: "rgba(0,123,255,0.25)",
                borderColor: "#007bff",
                pointBackgroundColor: "#007bff"
            }]
        },
        options: {
            scales: {
                r: {
                    suggestedMin: 30,
                    suggestedMax: 80
                }
            }
        }
    });

});
</script>
</body>
</html>
