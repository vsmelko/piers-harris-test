<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Piers-Harris 2 – Test</title>

<style>
    body {
        font-family: Arial, sans-serif;
        background: linear-gradient(to bottom right, #e7f3ff, #cfe6ff);
        margin: 0;
        padding: 0;
    }

    .container {
        max-width: 850px;
        margin: 40px auto;
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 6px 20px rgba(0,0,0,0.12);
        border: 1px solid #d0e4ff;
    }

    h1 {
        font-size: 32px;
        margin-bottom: 15px;
        color: #0a3d62;
        text-align: center;
        font-weight: 900;
        letter-spacing: 0.5px;
    }

    .instructions {
        text-align: center;
        margin-bottom: 25px;
        font-size: 18px;
        color: #1b4f72;
    }

    .question {
        padding: 14px;
        border-bottom: 1px solid #eee;
        border-radius: 8px;
        transition: 0.25s;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .question.active {
        background: #e0f0ff;
        border: 1px solid #4da3ff;
        box-shadow: 0 0 6px rgba(0,123,255,0.4);
    }

    .answer-label {
        font-weight: bold;
        margin-left: 10px;
        font-size: 18px;
    }

    .explain-label {
        font-size: 14px;
        color: #1b4f72;
        opacity: 0.7;
    }

    button {
        margin-top: 25px;
        padding: 16px 26px;
        font-size: 20px;
        background: linear-gradient(to right, #4da3ff, #007bff);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        width: 100%;
        box-shadow: 0 3px 8px rgba(0,0,0,0.2);
        font-weight: bold;
        letter-spacing: 0.5px;
    }

    button:hover {
        background: linear-gradient(to right, #6bb7ff, #3395ff);
    }

    .results {
        margin-top: 30px;
        padding-top: 15px;
        border-top: 2px solid #d6eaff;
    }

    .scale-result {
        font-size: 19px;
        padding: 6px 0;
    }

    #radarContainer {
        margin-top: 40px;
        padding: 20px 0;
    }

    canvas {
        max-width: 100%;
        max-height: 450px;
    }
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>

<body>
<div class="container">
    <h1>Piers-Harris 2 – Sebahodnotiaci dotazník</h1>

    <div class="instructions">
        Stláčaj <strong>1 (ÁNO)</strong> alebo <strong>0 (NIE)</strong>.<br>
        Aktuálna otázka je vždy zvýraznená modrou.
    </div>

    <!-- Question List -->
    <form id="testForm"></form>

    <!-- Evaluate Button -->
    <button id="btnEvaluate">Vyhodnotiť výsledky</button>

    <!-- Results Section -->
    <div id="results" class="results"></div>

    <!-- Radar Chart -->
    <div id="radarContainer">
        <canvas id="radarChart"></canvas>
    </div>
</div>
</body>

    <script>
// -----------------------------------------
// KEYING (scored YES / scored NO)
// -----------------------------------------

const keyedYes = [
    2,5,7,8,12,13,16,17,18,21,22,23,24,25,26,
    30,31,33,34,35,37,38,41,42,45,47,48,50,
    52,54,56,57,58,59
];

const keyedNo = [
    1,3,4,6,9,10,11,14,15,19,20,27,28,29,32,
    36,39,40,43,44,46,49,51,53,55,60
];

// -----------------------------------------
// SUBSCALE ITEMS
// -----------------------------------------

const scales = {
    BEH: [11,14,17,22,27,32,36,40,43,49,55],
    INT: [13,16,18,26,31,33,41,45,48,54,59],
    PHY: [5,10,20,23,28,37,39,44,50,57],
    FRE: [6,9,15,19,24,29,35,38,47,53,56],
    POP: [2,7,12,21,25,30,34,42,46,52,58],
    HAP: [1,3,4,8,33,51,60]
};

// -----------------------------------------
// VALIDITA – INC páry
// -----------------------------------------

const INC_PAIRS = [
    [1,47],[2,42],[3,41],[4,40],[5,43],[6,44],[7,45],
    [8,46],[9,36],[10,39],[11,32],[12,30],[13,31],[14,29],
    [15,28],[16,27],[17,26],[18,25],[19,24],[20,23],[21,22]
];

// -----------------------------------------
// RAW → T TABUĽKA (ČASŤ HODNÔT DOPLNÍME KEĎ DÁŠ OSTRÝ SCREENSHOT)
// -----------------------------------------

const T_TABLE = {

    TOT: {
        59:80, 58:78, 57:76, 56:74, 55:72,
        54:70, 53:69, 52:68, 51:67, 50:66,
        49:65, 48:64, 47:63, 46:62, 45:61,
        44:60, 43:59, 42:58, 41:57, 40:56,
        39:55, 38:54, 37:53, 36:52, 35:51,
        34:50, 33:49, 32:48, 31:47, 30:46,
        29:45, 28:44, 27:43, 26:42, 25:41,
        24:40, 23:39, 22:38, 21:37, 20:36,
        19:35, 18:34, 17:33, 16:32, 15:31,
        14:30, 13:29, 12:28, 11:27, 10:26,
        9:25, 8:24, 7:23, 6:22, 5:21, 
        4:20, 3:19, 2:18, 1:17, 0:16
    },

    BEH: {
        11:70, 10:67, 9:64, 8:61, 7:58,
        6:55, 5:52, 4:49, 3:46, 2:43,
        1:40, 0:37
    },

    INT: {
        11:72, 10:69, 9:66, 8:63, 7:60,
        6:57, 5:54, 4:51, 3:48, 2:45,
        1:42, 0:39
    },

    PHY: {
        10:70, 9:67, 8:64, 7:61, 6:58,
        5:55, 4:52, 3:49, 2:46, 1:43,
        0:40
    },

    FRE: {
        // NIEKTORÉ RAW CHÝBAJÚ — doplníme keď pošleš ostrý screenshot
        11:72, 10:69, 9:66, 8:63, 7:60,
        6:57, 5:54, 4:51, 3:48, 2:45,
        1:42, 0:39
    },

    POP: {
        // NIEKTORÉ RAW CHÝBAJÚ — doplníme keď pošleš ostrý screenshot
        11:70, 10:67, 9:64, 8:61, 7:58,
        6:55, 5:52, 4:49, 3:46, 2:43,
        1:40, 0:37
    },

    HAP: {
        // NIEKTORÉ RAW CHÝBAJÚ — doplníme keď pošleš ostrý screenshot
        7:70, 6:66, 5:62, 4:58, 3:54,
        2:50, 1:46, 0:42
    }
};

// -----------------------------------------
// INTERPRETÁCIA T-skóre
// -----------------------------------------

function interpret(T) {
    if (T >= 70) return "Výrazne nadpriemerné";
    if (T >= 60) return "Nadpriemer";
    if (T >= 45) return "Priemer";
    if (T >= 40) return "Nižší priemer";
    return "Podpriemer";
}

// -----------------------------------------
// GENERÁCIA OTÁZOK
// -----------------------------------------

let answers = {};
let activeQuestion = 1;

const form = document.getElementById("testForm");

for (let i = 1; i <= 60; i++) {
    const div = document.createElement("div");
    div.classList.add("question");
    div.id = `q-${i}`;
    div.innerHTML = `
        <div>
            <strong>${i}.</strong>
            <span class="answer-label" id="ans-${i}"></span>
        </div>
        <div class="explain-label">1 = Áno, 0 = Nie</div>
    `;
    form.appendChild(div);
}

// -----------------------------------------
// HIGHLIGHT ACTIVE
// -----------------------------------------

function highlightActive() {
    for (let i = 1; i <= 60; i++) {
        document.getElementById(`q-${i}`).classList.remove("active");
    }
    const q = document.getElementById(`q-${activeQuestion}`);
    q.classList.add("active");
    q.scrollIntoView({ behavior: "smooth", block: "center" });
}

highlightActive();

// -----------------------------------------
// KEYBOARD INPUT 1 / 0
// -----------------------------------------

document.addEventListener("keydown", function(e) {
    if (e.key === "1" || e.key === "0") {
        const value = Number(e.key);
        answers[activeQuestion] = value;

        const ansLabel = document.getElementById(`ans-${activeQuestion}`);
        ansLabel.textContent = value === 1 ? "ÁNO" : "NIE";
        ansLabel.style.color = value === 1 ? "#007bff" : "#ff4d4d";

        if (activeQuestion < 60) activeQuestion++;
        highlightActive();
    }
});

// -----------------------------------------
// EVALUATE
// -----------------------------------------

document.getElementById("btnEvaluate").addEventListener("click", () => {

    if (Object.keys(answers).length < 60) {
        alert("Vyplň všetky otázky.");
        return;
    }

    const resultsDiv = document.getElementById("results");
    let out = "<h2>Výsledky</h2>";

    // VALIDITA
    let incErrors = 0;
    INC_PAIRS.forEach(([a,b]) => {
        if (answers[a] !== answers[b]) incErrors++;
    });

    out += `<p><strong>Validita:</strong> ${
        incErrors === 0 ? "Test je platný" : "NEPLATNÝ – inkonzistencií: " + incErrors
    }</p>`;

    // SCORING FUNCTION
    function scoreItem(num) {
        if (keyedYes.includes(num)) return answers[num] === 1 ? 1 : 0;
        if (keyedNo.includes(num))  return answers[num] === 0 ? 1 : 0;
        return 0;
    }

    // TOT
    let totRaw = 0;
    for (let i = 1; i <= 60; i++) totRaw += scoreItem(i);

    const totT = T_TABLE.TOT[totRaw] ?? null;

    out += `<p><strong>TOT RAW:</strong> ${totRaw}, 
            <strong>TOT T:</strong> ${totT} 
            (${totT !== null ? interpret(totT) : "N/A"})</p>`;

    // SUBŠKÁLY
    out += "<h3>Subškály</h3>";

    let tScores = [];

    for (let scale in scales) {
        let raw = 0;
        scales[scale].forEach(q => raw += scoreItem(q));
        let T = T_TABLE[scale][raw] ?? null;

        out += `<p><strong>${scale}</strong>: RAW ${raw}, 
                T ${T} (${T !== null ? interpret(T) : "N/A"})</p>`;

        tScores.push(T ?? 0);
    }

    resultsDiv.innerHTML = out;

    // -----------------------------------
    // RADAR GRAF
    // -----------------------------------

    const ctx = document.getElementById("radarChart");

    new Chart(ctx, {
        type: 'radar',
        data: {
            labels: ['BEH','INT','PHY','FRE','POP','HAP'],
            datasets: [{
                label: 'T-skóre subškál',
                data: tScores,
                fill: true,
                backgroundColor: "rgba(0,123,255,0.25)",
                borderColor: "#007bff",
                pointBackgroundColor: "#007bff"
            }]
        },
        options: {
            scales: {
                r: {
                    suggestedMin: 30,
                    suggestedMax: 80
                }
            }
        }
    });

});
</script>
